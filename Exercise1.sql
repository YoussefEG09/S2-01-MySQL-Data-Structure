-- MySQL Script generated by MySQL Workbench
-- Mon Oct 27 11:12:33 2025
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `optica` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;

USE `optica` ;

-- -----------------------------------------------------
-- Table `mydb`.`clients`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `optica`.`clients` ;

CREATE TABLE IF NOT EXISTS `optica`.`clients` (
  `clients_id` INT NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `postal_adress` VARCHAR(45) NULL,
  `email` VARCHAR(45) NULL,
  `registration_date` DATE NOT NULL,
  `recommended_by` INT NULL,
  PRIMARY KEY (`clients_id`),
  CONSTRAINT `fk_clients_clients1`
    FOREIGN KEY (`recommended_by`)
    REFERENCES `optica`.`clients` (`clients_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE INDEX `fk_clients_clients1_idx` ON `optica`.`clients` (`recommended_by` ASC) VISIBLE;


-- -----------------------------------------------------
-- Table `mydb`.`employees`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `optica`.`employees` ;

CREATE TABLE IF NOT EXISTS `optica`.`employees` (
  `employees_id` INT NOT NULL,
  `name` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`employees_id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `optica`.`supplier`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `optica`.`supplier` ;

CREATE TABLE IF NOT EXISTS `optica`.`supplier` (
  `supplier_id` INT NOT NULL,
  `name` VARCHAR(45) NULL,
  `street` VARCHAR(45) NULL,
  `number` VARCHAR(10) NULL,
  `floor` VARCHAR(10) NULL,
  `door` VARCHAR(10) NULL,
  `city` VARCHAR(45) NULL,
  `postal_code` VARCHAR(45) NULL,
  `country` VARCHAR(45) NULL,
  `phone` VARCHAR(20) NULL,
  `fax` VARCHAR(20) NULL,
  `nif` VARCHAR(20) NULL,
  PRIMARY KEY (`supplier_id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`glasses`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `optica`.`glasses` ;

CREATE TABLE IF NOT EXISTS `optica`.`glasses` (
  `glasses_id` INT NOT NULL,
  `brand` VARCHAR(100) NOT NULL,
  `lens_power` DECIMAL(4,2) NULL,
  `frame_type` ENUM('floating', 'plastic', 'metal') NULL,
  `frame_colour` VARCHAR(45) NULL,
  `lens_colour` VARCHAR(45) NULL,
  `price` DECIMAL(10,2) NOT NULL,
  `supplier_supplier_id` INT NOT NULL,
  PRIMARY KEY (`glasses_id`),
  CONSTRAINT `fk_glasses_supplier`
    FOREIGN KEY (`supplier_supplier_id`)
    REFERENCES `optica`.`supplier` (`supplier_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE INDEX `fk_glasses_supplier_idx` ON `optica`.`glasses` (`supplier_supplier_id` ASC) VISIBLE;


-- -----------------------------------------------------
-- Table `mydb`.`sales`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `optica`.`sales` ;

CREATE TABLE IF NOT EXISTS `optica`.`sales` (
  `idsales` INT NOT NULL,
  `glasses_glasses_id` INT NOT NULL,
  `employees_employees_id` INT NOT NULL,
  `clients_clients_id` INT NOT NULL,
  `sale_date` DATE NOT NULL,
  PRIMARY KEY (`idsales`),
  CONSTRAINT `fk_sales_glasses1`
    FOREIGN KEY (`glasses_glasses_id`)
    REFERENCES `optica`.`glasses` (`glasses_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_sales_employees1`
    FOREIGN KEY (`employees_employees_id`)
    REFERENCES `optica`.`employees` (`employees_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_sales_clients1`
    FOREIGN KEY (`clients_clients_id`)
    REFERENCES `optica`.`clients` (`clients_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE INDEX `fk_sales_glasses1_idx` ON `optica`.`sales` (`glasses_glasses_id` ASC) VISIBLE;

CREATE INDEX `fk_sales_employees1_idx` ON `optica`.`sales` (`employees_employees_id` ASC) VISIBLE;

CREATE INDEX `fk_sales_clients1_idx` ON `optica`.`sales` (`clients_clients_id` ASC) VISIBLE;


INSERT INTO `optica`.`clients` (`clients_id`, `name`, `postal_adress`, `email`, `registration_date`, `recommended_by`)
VALUES
(1, 'Ana López', 'Calle Falsa 123', 'ana@example.com', '2025-01-10', NULL),
(2, 'Carlos Pérez', 'Av. Libertad 45', 'carlos@example.com', '2025-02-20', 1),
(3, 'María Gómez', 'Calle Mayor 12', 'maria@example.com', '2025-03-05', 1);


INSERT INTO `optica`.`employees` (`employees_id`, `name`)
VALUES
(1, 'Laura Martínez'),
(2, 'Juan Rodríguez'),
(3, 'Sergio Fernández');


INSERT INTO `optica`.`supplier` (`supplier_id`, `name`, `street`, `number`, `floor`, `door`, `city`, `postal_code`, `country`, `phone`, `fax`, `nif`)
VALUES
(1, 'OptiGlass S.A.', 'Calle Cristal', '10', '1', 'A', 'Madrid', '28001', 'España', '910000001', '910000002', 'A12345678'),
(2, 'LentesPlus', 'Av. Óptica', '5', NULL, NULL, 'Barcelona', '08001', 'España', '930000003', NULL, 'B87654321');


INSERT INTO `optica`.`glasses` (`glasses_id`, `brand`, `lens_power`, `frame_type`, `frame_colour`, `lens_colour`, `price`, `supplier_supplier_id`)
VALUES
(1, 'Ray-Ban', 1.50, 'metal', 'black', 'blue', 120.50, 1),
(2, 'Oakley', 2.00, 'plastic', 'red', 'grey', 150.00, 2),
(3, 'Persol', 0.75, 'floating', 'brown', 'green', 180.00, 1);


INSERT INTO `optica`.`sales` (`idsales`, `glasses_glasses_id`, `employees_employees_id`, `clients_clients_id`, `sale_date`)
VALUES
(1, 1, 1, 1, '2025-04-10'),
(2, 2, 2, 2, '2025-05-15'),
(3, 3, 3, 3, '2025-06-20');


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;